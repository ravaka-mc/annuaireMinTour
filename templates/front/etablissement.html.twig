{% extends 'base.html.twig' %}

{% block title %}{{ etablissement.nom }}{% endblock %}

{% block body %}
<main>
    <div class="top-detail">
        <div class="wrapper">
            <div class="breadcrumbs">
				<a href="{{ path('app_home') }}" title="Accueil" class="home">Accueil</a>
				{% if etablissement.category is not null %}
					<a href="{{ path('app_category', {slug:etablissement.category.getSlug()}) }}" title="Hébergement ">{{ etablissement.category }}</a>
				{% endif %}
				<span class="breadcrumb_last" aria-current="page" >{{ etablissement.nom }}</span>
            </div>
            <div class="wrap-detail">
                <div class="images">
				{% if etablissement.category.viewType != 'TYPE_5'%}
					{% if etablissement.avatar is not null %}
						<img src="{{ asset('uploads/etablissements/' ~ etablissement.getAvatar()) }}">
					{% else %}
						<img src="{{ asset('front/images/default-etablissement.svg') }}">
					{% endif %}
				{% else %}
					<img src="{{ asset('front/images/profil-guide.svg') }}">
				{% endif %}
                </div>
                <div class="texteitem">
                    <h1>{{ etablissement.nom }}</h1>
					<ul>
						{% if etablissement.region is not null %}
						<li> <span class="localisation">{{ etablissement.region }}</span></li>
						{% endif %}
						{% if etablissement.category is not null %}
							<li><span class="domaine"> {{ etablissement.category }}</span></li>
						{% endif %}
						{% if etablissement.category.viewType != 'TYPE_1' and  etablissement.category.viewType != 'TYPE_5' and etablissement.classement is not null %}
						<li>
							<div class="classement">Classement :
								<span class="clssment">
									<input type="hidden" id="jsclass" value="{{ etablissement.classement }}">
									<span></span>
								</span>
							</div>
						</li>
						{% endif %}
					</ul>
                </div>
            </div>
        </div>
    </div>
    <div class="wrapper">
        <div class="information">
            <div class="information-detail">
				<div class="flex-beetween">
					<div class="gtitre">Coordonnées</div>
					<div class="resoc">
						{% if etablissement.facebook != ''%}
						<a href="{{ etablissement.facebook }}" class="facebook"></a>
						{% endif %}
						{% if etablissement.linkedin != ''%}
						<a href="{{ etablissement.linkedin }}" class="linkedin"></a>
						{% endif %}
					</div>
				</div>
                <div class="details">
                    <div class="item adresse">
                        <div class="stitre">
                            Adresse
                        </div>
                        <span>{{ etablissement.adresse }}, {{ etablissement.ville }}, {{ etablissement.codePostal }} </span>
                    </div>
					{% if etablissement.email is not null %}
						<div class="item email">
							<div class="stitre">
								E-mail
							</div>
							<span><a href="mailto:{{ etablissement.email }}">{{ etablissement.email }}</a></span>
						</div>
                    {% endif %}
                    {% if etablissement.telephone is not null %}
						<div class="item telephone">
							<div class="stitre">
								Téléphone
							</div>
							<span><a href="tel:+261{{ etablissement.telephone|trim }}">+261 {{ etablissement.telephone }}</a></span>
						</div>
                    {% endif %}
                    {% if etablissement.siteWeb is not null %}
						<div class="item siteweb">
							<div class="stitre">
								Site web
							</div>
							<span><a href="{{ etablissement.siteWeb }}" target="_blank">{{ etablissement.siteWeb }}</a></span>
						</div>
                    {% endif %}
                </div>
                <div class="gtitre">
                    Autorisation d'ouverture
                </div>
                <div class="auto-details">
					{% if etablissement.categorieGuide|length > 0 %}
					<div class="item catry">
						<div class="stitre">
							Catégorie
						</div>
						<div><strong>Catégorie : </strong>
							Guide
							{% for category in etablissement.categorieGuide %}
								{% if category == 'GUIDE_NATIONAL' %}
									nationale,
								{% elseif category == 'GUIDE_REGIONAL'%}
									régionale,
								{% elseif category == 'GUIDE_LOCAL'%}
									locale,
								{% elseif category == 'GUIDE_SPECIALISE'%}
									Spécialisé
								{% endif %}
							{% endfor %}
						</div>
						{% if etablissement.region is not null %}
						<div><strong>Région : </strong>{{  etablissement.region.nom }} </div>
						{% endif %}
						{% if etablissement.categorieAutorisation != '' %}
						<div><strong>Spécialisation : </strong>{{  etablissement.categorieAutorisation }}</div>
						{% endif %}
					</div>
					{% endif %}
					{% if etablissement.dateOuverture is not null %}
						<div class="item date">
							<div class="stitre">
								Date d'ouverture
							</div>
							<span>{{ etablissement.dateOuverture|format_datetime(locale='fr',pattern="dd MMMM YYYY") }}</span>
						</div>
					{% endif %}
					{% if etablissement.reference is not null %}
					<div class="item reference">
						<div class="stitre">
							N° de référence
						</div>
						<span>{{ etablissement.reference }}</span>
					</div>
					{% endif %}
                    {% if etablissement.licenceA or etablissement.licenceB or etablissement.licenceC%}
                    <div class="item licence">
                        <div class="stitre">
                            Licence
                        </div>
                        <div class="licence-detail">
                            {% if etablissement.licenceA %}
							<div>
								<p><span class="licence-class">A</span> (Agence de voyage)</p>
								<span class="licence-date">Le <strong>{{ etablissement.dateLicenceA|date('d / m / Y') }}</strong></span>
								<div class="licence-ref">{{ etablissement.referenceA }}</div>
							</div>
                            {% endif %}
                            {% if etablissement.licenceB %}
							<div>
								<p><span class="licence-class">B</span> (Tour-opérateur)</p>
								<span class="licence-date">Le <strong>{{ etablissement.dateLicenceB|date('d / m / Y') }}</strong></span>
								<div class="licence-ref">{{ etablissement.referenceB }}</div>
							</div>
                            {% endif %}
                            {% if etablissement.licenceC %}
                            <div>
								<p><span class="licence-class">C</span> (Prestation touristiques spécialisées)</p>
								<span class="licence-date">Le <strong>{{ etablissement.dateLicenceC|date('d / m / Y') }}</strong></span>
								<div class="licence-ref">{{ etablissement.referenceC }}</div>
							</div>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}
					{% if etablissement.activites|length > 0 %}
						<div class="item activite">
							<div class="stitre">
								Activité
							</div>
							<ul>
								{% for activite in etablissement.activites %}
									<li>{{ activite.nom }}</li>
								{% endfor %}
							</ul>
						</div>
					{% endif %}
                </div>
            </div>
        </div>
		<div class="stat textcenter">
        {% if etablissement.category.viewType != 'TYPE_5' and ( etablissement.capaciteAccueil != '' or etablissement.nombreSalaries != '' or etablissement.nombreChambres != '' or etablissement.nombreCouverts)%}
		
			<div class="gtitre">
				L'établissement en chiffres
			</div>
			<div class="stat-detail text-left">
				{% if etablissement.capaciteAccueil is not null %}
				<div class="item">
					<div class="icon">
						<img src="{{ asset('front/images/accueil.svg') }}" alt="">
					</div>
					<div class="texte">
					<p><span class="numscroller" data-min="1" data-max="{{ etablissement.capaciteAccueil}}" data-delay="5" data-increment="10">{{ etablissement.capaciteAccueil}}</span></p>
					<div class="n-titre">Capacité d'accueil</div>
					</div>
				</div>
				{% endif %}
				{% if etablissement.nombreSalaries is not null %}
				<div class="item">
					<div class="icon">
						<img src="{{ asset('front/images/salarie.svg') }}" alt="">
					</div>
					<div class="texte">
						<p><span class="numscroller" data-min="1" data-max="{{ etablissement.nombreSalaries + etablissement.nombreSalaireFemme }}" data-delay="5" data-increment="10">{{ etablissement.nombreSalaries + etablissement.nombreSalaireFemme}}</span></p>
					<div class="n-titre">Salariés</div>
					</div>
				</div>
				{% endif %}
				{% if etablissement.nombreChambres is not null %}
				<div class="item">
					<div class="icon">
						<img src="{{ asset('front/images/chambres.svg') }}" alt="">
					</div>
					<div class="texte">
					<p><span class="numscroller" data-min="1" data-max="{{ etablissement.nombreChambres }}" data-delay="5" data-increment="10">>{{ etablissement.nombreChambres}}</span></p>
					<div class="n-titre">Chambres</div>
					</div>
				</div>
				{% endif %}
				{% if etablissement.nombreCouverts is not null %}
				<div class="item">
					<div class="icon">
						<img src="{{ asset('front/images/couvert.svg') }}" alt="">
					</div>
					<div class="texte">
					<p><span class="numscroller" data-min="1" data-max="{{ etablissement.nombreCouverts}}   " data-delay="5" data-increment="10">{{ etablissement.nombreCouverts}}</span> </p>
					<div class="n-titre">Nbre de couvert</div>
					</div>
				</div>
				{% endif %}
				{% if etablissement.nombreLit is not null %}
				<div class="item">
					<div class="icon">
						<img src="{{ asset('front/images/lits.svg') }}" alt="">
					</div>
					<div class="texte">
						<p><span class="numscroller" data-min="1" data-max="{{ etablissement.nombreLit }}" data-delay="5" data-increment="10">{{ etablissement.nombreLit }}</span> </p>
						<div class="n-titre">Lits</div>
					</div>
				</div>
				{% endif %}
				{% if etablissement.nombreResto is not null %}
				<div class="item">
					<div class="icon">
						<img src="{{ asset('front/images/restaurants.svg') }}" alt="">
					</div>
					<div class="texte">
						<p><span class="numscroller" data-min="1" data-max="{{ etablissement.nombreResto }}" data-delay="5" data-increment="10">{{ etablissement.nombreResto }}</span> </p>
						<div class="n-titre">Restaurants</div>
					</div>
				</div>
				{% endif %}
				{% if etablissement.nombreVoiture is not null %}
				<div class="item">
					<div class="icon">
						<img src="{{ asset('front/images/voitures.svg') }}" alt="">
					</div>
					<div class="texte">
						<p><span class="numscroller" data-min="1" data-max="{{ etablissement.nombreVoiture }}" data-delay="5" data-increment="10">{{ etablissement.nombreVoiture }}</span> </p>
						<div class="n-titre">Transports motorisés</div>
					</div>
				</div>
				{% endif %}
				{% if etablissement.salleConference is not null %}
				<div class="item">
					<div class="icon">
						<img src="{{ asset('front/images/salle.svg') }}" alt="">
					</div>
					<div class="texte">
						<p><span class="numscroller" data-min="1" data-max="{{ etablissement.salleConference}}" data-delay="5" data-increment="10">{{ etablissement.salleConference}}</span> m2</p>
						<div class="n-titre">Salle de conférence</div>
					</div>
				</div>
				{% endif %}
				{% if etablissement.superficieSalle is not null %}
				<div class="item">
					<div class="icon">
						<img src="{{ asset('front/images/nbre-salle-conference.svg') }}" alt="">
					</div>
					<div class="texte">
						<p><span class="numscroller" data-min="1" data-max="{{ etablissement.superficieSalle }}" data-delay="5" data-increment="10">{{ etablissement.superficieSalle }}</span> m2</p>
						<div class="n-titre">Salle de conférence</div>
					</div>
				</div>
				{% endif %}
			</div>
			{% endif %}
			<a data-fancybox href="#infopop" class="link-signal">Signaler cet établissement</a>
		</div>
        
    </div>
</main>
<div class="popup" id="infopop">
	<div class="popup__top gtitre">
		Signaler
	</div>
	<div class="popup__content">
		<form name="{{ form.vars.full_name }}" action="{{ path('app_etablissement_signaler', {slug:etablissement.slug}) }}" method="post">
			<div class="form-wrap">
				<div class="form-control">
					<label for="">établissment</label>
					<input type="text" value="{{etablissement.nom}}" readonly>
				</div>
				<div class="form-control">
					<label for="">Nom</label>
					{{ form_widget(form.nom) }}
				</div>
				<div class="form-control">
					<label for="">E-mail</label>
					{{ form_widget(form.email) }}
				</div>
				<div class="form-control">
					<label for="">Motif</label>
					{{ form_widget(form.motif) }}
				</div>
			</div>
			<div class="text-center">
                {{ form_widget(form._token) }}
				<button type="submit" class="btn"><span>Signaler</span></button>
			</div>
		</form>
	</div>
</div>
<a data-fancybox="" data-src="#popup-succesadd" class="view"></a>
<!-- Modal signalement succes -->
<div id="popup-succesadd" class="pop_sucsadd" style="display:none; max-width:500px;">
	<div class="innerpad">
		<p>Votre signalement à été bien envoyé</p>
	</div>
</div>
{% endblock %}
{% block javascripts %}
	<script>
		$(document).ready(function () {
			{% if app.session.flashBag.has('success') %}
				jQuery('a.view').trigger('click')
                $('#popup-succesadd .innerpad').html("<p>{{ app.session.flashBag.get('success')[0] }}</p>")
			{% endif %}
			// Classement //
			const classerver = $('.clssment input').val();
			if (classerver == "Non classé") {
				$('.clssment span').text('NC');
			} else {
				const lowercase = classerver.toLowerCase();
				const sansaccent = lowercase.normalize("NFD").replace(/[\u0300-\u036f]/g, "");
				const slipclassm = sansaccent.split(' ');
				if(slipclassm[1] == 'ravinala') {
					var wspan = slipclassm[0] * 33.33
				} else if (slipclassm[1] == 'etoiles' || slipclassm[1] == 'etoile') {
					var wspan = slipclassm[0] * 20
				}
				$('.clssment').addClass(slipclassm[1]);
				$('.clssment span').css('width', wspan + '%');
			}
		})
	</script>
{% endblock %}
